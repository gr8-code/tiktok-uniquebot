# uniqualizer.py

import random
import os
from PIL import Image, ImageDraw, ImageFont, ImageFilter, ImageEnhance
import numpy as np
from io import BytesIO

class PhotoUniqulizer:
    def __init__(self):
        # –õ–∏—Ü–∞ –∏ —Å–º–∞–π–ª—ã
        self.smiles_faces = [
            'üòÄ', 'üòÉ', 'üòÑ', 'üòÅ', 'üòÜ', 'üòÖ', 'ü§£', 'üòÇ', 'üôÇ', 'üôÉ',
            'üòâ', 'üòä', 'üòá', 'ü•∞', 'üòç', 'ü§©', 'üòò', 'üòó', 'üòö', 'üòô',
            'üòã', 'üòõ', 'üòú', 'ü§™', 'üòù', 'ü§ë', 'ü§ó', 'ü§≠', 'ü§´', 'ü§î',
            'ü§ê', 'ü§®', 'üòê', 'üòë', 'üò∂', 'üòè', 'üòí', 'üôÑ', 'üò¨', 'ü§•',
            'üòå', 'üòî', 'üò™', 'ü§§', 'üò¥', 'üò∑', 'ü§í', 'ü§ï', 'ü§¢', 'ü§Æ',
            'ü§ß', 'ü•µ', 'ü•∂', 'ü•¥', 'üòµ', 'ü§Ø', 'ü§†', 'ü•≥', 'üòé', 'ü§ì',
            'üßê', 'üòï', 'üòü', 'üôÅ', 'üòÆ', 'üòØ', 'üò≤', 'üò≥', 'ü•∫', 'üò¶',
            'üòß', 'üò®', 'üò∞', 'üò•', 'üò¢', 'üò≠', 'üò±', 'üòñ', 'üò£', 'üòû',
            'üòì', 'üò©', 'üò´', 'ü•±', 'üò§', 'üò°', 'üò†', 'ü§¨', 'üòà', 'üëø',
            'üíÄ', 'üí©', 'ü§°', 'üëπ', 'üë∫', 'üëª', 'üëΩ', 'üëæ', 'ü§ñ', 'üò∫',
            'üò∏', 'üòπ', 'üòª', 'üòº', 'üòΩ', 'üôÄ', 'üòø', 'üòæ'
        ]
        
        # –ñ–µ—Å—Ç—ã –∏ —Ä—É–∫–∏
        self.gestures_hands = [
            'üëã', 'ü§ö', 'üñê', '‚úã', 'üññ', 'üëå', 'ü§è', '‚úå', 'ü§û', 'ü§ü',
            'ü§ò', 'ü§ô', 'üëà', 'üëâ', 'üëÜ', 'üñï', 'üëá', '‚òù', 'üëç', 'üëé',
            '‚úä', 'üëä', 'ü§õ', 'ü§ú', 'üëè', 'üôå', 'üëê', 'ü§≤', 'ü§ù', 'üôè',
            'üí™', 'ü¶æ', 'ü¶ø', 'ü¶µ', 'ü¶∂', 'üëÇ', 'ü¶ª', 'üëÉ', 'üß†', 'ü¶∑',
            'ü¶¥', 'üëÄ', 'üëÅ', 'üëÖ', 'üëÑ', 'üíã', 'ü©∏'
        ]
        
        # –õ—é–¥–∏
        self.people = [
            'üë∂', 'üëß', 'üßí', 'üë¶', 'üë©', 'üßë', 'üë®', 'üëµ', 'üßì', 'üë¥',
            'üë≤', 'üë≥', 'üßï', 'üëÆ', 'üë∑', 'üíÇ', 'üïµ', 'üë©‚Äç‚öïÔ∏è', 'üë®‚Äç‚öïÔ∏è', 'üë©‚Äçüåæ',
            'üë®‚Äçüåæ', 'üë©‚Äçüç≥', 'üë®‚Äçüç≥', 'üë©‚Äçüéì', 'üë®‚Äçüéì', 'üë©‚Äçüé§', 'üë®‚Äçüé§', 'üë©‚Äçüè´', 'üë®‚Äçüè´', 'üë©‚Äçüè≠',
            'üë®‚Äçüè≠', 'üë©‚Äçüíª', 'üë®‚Äçüíª', 'üë©‚Äçüíº', 'üë®‚Äçüíº', 'üë©‚Äçüîß', 'üë®‚Äçüîß', 'üë©‚Äçüî¨', 'üë®‚Äçüî¨', 'üë©‚Äçüé®',
            'üë®‚Äçüé®', 'üë©‚Äçüöí', 'üë®‚Äçüöí', 'üë©‚Äç‚úàÔ∏è', 'üë®‚Äç‚úàÔ∏è', 'üë©‚ÄçüöÄ', 'üë®‚ÄçüöÄ', 'üë©‚Äç‚öñÔ∏è', 'üë®‚Äç‚öñÔ∏è', 'üë∞',
            'ü§µ', 'üë∏', 'ü§¥', 'ü¶∏', 'ü¶π', 'üßô', 'üßö', 'üßõ', 'üßú', 'üßù',
            'üßû', 'üßü', 'üíÜ', 'üíá', 'üö∂', 'üßç', 'üßé', 'üèÉ', 'üíÉ', 'üï∫'
        ]
        
        # –ñ–∏–≤–æ—Ç–Ω—ã–µ
        self.animals = [
            'üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº', 'üê®', 'üêØ',
            'ü¶Å', 'üêÆ', 'üê∑', 'üêΩ', 'üê∏', 'üêµ', 'üôà', 'üôâ', 'üôä', 'üêí',
            'üêî', 'üêß', 'üê¶', 'üê§', 'üê£', 'üê•', 'ü¶Ü', 'ü¶Ö', 'ü¶â', 'ü¶á',
            'üê∫', 'üêó', 'üê¥', 'ü¶Ñ', 'üêù', 'üêõ', 'ü¶ã', 'üêå', 'üêû', 'üêú',
            'ü¶ü', 'ü¶ó', 'üï∑', 'üï∏', 'ü¶Ç', 'üê¢', 'üêç', 'ü¶é', 'ü¶ñ', 'ü¶ï',
            'üêô', 'ü¶ë', 'ü¶ê', 'ü¶û', 'ü¶Ä', 'üê°', 'üê†', 'üêü', 'üê¨', 'üê≥',
            'üêã', 'ü¶à', 'üêä', 'üêÖ', 'üêÜ', 'ü¶ì', 'ü¶ç', 'ü¶ß', 'üêò', 'ü¶õ',
            'ü¶è', 'üê™', 'üê´', 'ü¶í', 'ü¶ò', 'üêÉ', 'üêÇ', 'üêÑ', 'üêé', 'üêñ',
            'üêè', 'üêë', 'ü¶ô', 'üêê', 'ü¶å', 'üêï', 'üê©', 'ü¶Æ', 'üêï‚Äçü¶∫', 'üêà',
            'üêì', 'ü¶É', 'ü¶ö', 'ü¶ú', 'ü¶¢', 'ü¶©', 'üïä', 'üêá', 'ü¶ù', 'ü¶®',
            'ü¶°', 'ü¶¶', 'ü¶•', 'üêÅ', 'üêÄ', 'üêø', 'ü¶î'
        ]
        
        # –ï–¥–∞
        self.food = [
            'üçè', 'üçé', 'üçê', 'üçä', 'üçã', 'üçå', 'üçâ', 'üçá', 'üçì', 'üçà',
            'üçí', 'üçë', 'ü•≠', 'üçç', 'ü••', 'ü•ù', 'üçÖ', 'üçÜ', 'ü•ë', 'ü•¶',
            'ü•¨', 'ü•í', 'üå∂', 'üåΩ', 'ü•ï', 'üßÑ', 'üßÖ', 'ü•î', 'üç†', 'ü•ê',
            'ü•Ø', 'üçû', 'ü•ñ', 'ü•®', 'üßÄ', 'ü•ö', 'üç≥', 'üßà', 'ü•û', 'üßá',
            'ü•ì', 'ü•©', 'üçó', 'üçñ', 'ü¶¥', 'üå≠', 'üçî', 'üçü', 'üçï', 'ü•™',
            'ü•ô', 'üßÜ', 'üåÆ', 'üåØ', 'ü•ó', 'ü•ò', 'ü•´', 'üçù', 'üçú', 'üç≤',
            'üçõ', 'üç£', 'üç±', 'ü•ü', 'ü¶™', 'üç§', 'üçô', 'üçö', 'üçò', 'üç•',
            'ü•†', 'ü•Æ', 'üç¢', 'üç°', 'üçß', 'üç®', 'üç¶', 'ü•ß', 'üßÅ', 'üç∞',
            'üéÇ', 'üçÆ', 'üç≠', 'üç¨', 'üç´', 'üçø', 'üç©', 'üç™', 'üå∞', 'ü•ú',
            'üçØ', 'ü•õ', 'üçº', '‚òï', 'üçµ', 'üßÉ', 'ü•§', 'üç∂', 'üç∫', 'üçª',
            'ü•Ç', 'üç∑', 'ü•É', 'üç∏', 'üçπ', 'üßâ', 'üçæ', 'üßä', 'ü•Ñ', 'üç¥',
            'üçΩ', 'ü•£', 'ü•°', 'ü•¢', 'üßÇ'
        ]
        
        # –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ —Å–ø–æ—Ä—Ç
        self.activities = [
            '‚öΩ', 'üèÄ', 'üèà', '‚öæ', 'ü•é', 'üéæ', 'üèê', 'üèâ', 'ü•è', 'üé±',
            'ü™Ä', 'üèì', 'üè∏', 'üèí', 'üèë', 'ü•ç', 'üèè', 'ü•Ö', '‚õ≥', 'ü™Å',
            'üèπ', 'üé£', 'ü§ø', 'ü•ä', 'ü•ã', 'üéΩ', 'üõπ', 'üõ∑', '‚õ∏', 'ü•å',
            'üéø', '‚õ∑', 'üèÇ', 'ü™Ç', 'üèã', 'ü§º', 'ü§∏', 'ü§∫', '‚õπ', 'ü§æ',
            'üèå', 'üèá', 'üßò', 'üèä', 'ü§Ω', 'üö£', 'üßó', 'üöµ', 'üö¥', 'üèÜ',
            'ü•á', 'ü•à', 'ü•â', 'üèÖ', 'üéñ', 'üéó', 'üèµ', 'üé´', 'üéü', 'üé™',
            'ü§π', 'üé≠', 'ü©∞', 'üé®', 'üé¨', 'üé§', 'üéß', 'üéº', 'üéπ', 'ü•Å',
            'üé∑', 'üé∫', 'üé∏', 'ü™ï', 'üéª', 'üé≤', '‚ôü', 'üéØ', 'üé≥', 'üéÆ',
            'üé∞', 'üß©'
        ]
        
        # –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç
        self.travel = [
            'üöó', 'üöï', 'üöô', 'üöå', 'üöé', 'üèé', 'üöì', 'üöë', 'üöí', 'üöê',
            'üöö', 'üöõ', 'üöú', 'ü¶Ø', 'ü¶Ω', 'ü¶º', 'üõ¥', 'üö≤', 'üõµ', 'üèç',
            'üõ∫', 'üö®', 'üöî', 'üöç', 'üöò', 'üöñ', 'üö°', 'üö†', 'üöü', 'üöÉ',
            'üöã', 'üöû', 'üöù', 'üöÑ', 'üöÖ', 'üöà', 'üöÇ', 'üöÜ', 'üöá', 'üöä',
            'üöâ', '‚úà', 'üõ´', 'üõ¨', 'üõ©', 'üí∫', 'üõ∞', 'üöÄ', 'üõ∏', 'üöÅ',
            'üõ∂', '‚õµ', 'üö§', 'üõ•', 'üõ≥', '‚õ¥', 'üö¢', '‚öì', '‚õΩ', 'üöß',
            'üö¶', 'üö•', 'üöè', 'üó∫', 'üóø', 'üóΩ', 'üóº', 'üè∞', 'üèØ', 'üèü',
            'üé°', 'üé¢', 'üé†', '‚õ≤', '‚õ±', 'üèñ', 'üèù', 'üèú', 'üåã', '‚õ∞',
            'üèî', 'üóª', 'üèï', '‚õ∫', 'üè†', 'üè°', 'üèò', 'üèö', 'üèó', 'üè≠',
            'üè¢', 'üè¨', 'üè£', 'üè§', 'üè•', 'üè¶', 'üè®', 'üè™', 'üè´', 'üè©',
            'üíí', 'üèõ', '‚õ™', 'üïå', 'üïç', 'üõï', 'üïã'
        ]
        
        # –û–±—ä–µ–∫—Ç—ã
        self.objects = [
            '‚åö', 'üì±', 'üì≤', 'üíª', '‚å®', 'üñ•', 'üñ®', 'üñ±', 'üñ≤', 'üïπ',
            'üóú', 'üíΩ', 'üíæ', 'üíø', 'üìÄ', 'üìº', 'üì∑', 'üì∏', 'üìπ', 'üé•',
            'üìΩ', 'üéû', 'üìû', '‚òé', 'üìü', 'üì†', 'üì∫', 'üìª', 'üéô', 'üéö',
            'üéõ', 'üß≠', '‚è±', '‚è≤', '‚è∞', 'üï∞', '‚åõ', '‚è≥', 'üì°', 'üîã',
            'üîå', 'üí°', 'üî¶', 'üïØ', 'ü™î', 'üßØ', 'üõ¢', 'üí∏', 'üíµ', 'üí¥',
            'üí∂', 'üí∑', 'üí∞', 'üí≥', 'üíé', '‚öñ', 'üß∞', 'üîß', 'üî®', '‚öí',
            'üõ†', '‚õè', 'üî©', '‚öô', 'üß±', '‚õì', 'üß≤', 'üî´', 'üí£', 'üß®',
            'ü™ì', 'üî™', 'üó°', '‚öî', 'üõ°', 'üö¨', '‚ö∞', '‚ö±', 'üè∫', 'üîÆ',
            'üìø', 'üßø', 'üíà', '‚öó', 'üî≠', 'üî¨', 'üï≥', 'ü©π', 'ü©∫', 'üíä',
            'üíâ', 'ü©∏', 'üß¨', 'ü¶†', 'üß´', 'üß™', 'üå°', 'üßπ', 'üß∫', 'üßª',
            'üöΩ', 'üö∞', 'üöø', 'üõÅ', 'üõÄ', 'üßº', 'ü™í', 'üßΩ', 'üß¥', 'üõé',
            'üîë', 'üóù', 'üö™', 'ü™ë', 'üõã', 'üõè', 'üõå', 'üß∏', 'üñº', 'üõç',
            'üõí', 'üéÅ', 'üéà', 'üéè', 'üéÄ', 'üéä', 'üéâ', 'üéé', 'üèÆ', 'üéê',
            'üßß', '‚úâ', 'üì©', 'üì®', 'üìß', 'üíå', 'üì•', 'üì§', 'üì¶', 'üè∑',
            'üì™', 'üì´', 'üì¨', 'üì≠', 'üìÆ', 'üìØ', 'üìú', 'üìÉ', 'üìÑ', 'üìë'
        ]
        
        # –°–∏–º–≤–æ–ª—ã –∏ —Å–µ—Ä–¥—Ü–∞
        self.symbols = [
            '‚ù§', 'üß°', 'üíõ', 'üíö', 'üíô', 'üíú', 'üñ§', 'ü§ç', 'ü§é', 'üíî',
            '‚ù£', 'üíï', 'üíû', 'üíì', 'üíó', 'üíñ', 'üíò', 'üíù', 'üíü', '‚òÆ',
            '‚úù', '‚ò™', 'üïâ', '‚ò∏', '‚ú°', 'üîØ', 'üïé', '‚òØ', '‚ò¶', 'üõê',
            '‚õé', '‚ôà', '‚ôâ', '‚ôä', '‚ôã', '‚ôå', '‚ôç', '‚ôé', '‚ôè', '‚ôê',
            '‚ôë', '‚ôí', '‚ôì', 'üÜî', '‚öõ', 'üâë', '‚ò¢', '‚ò£', 'üì¥', 'üì≥',
            'üà∂', 'üàö', 'üà∏', 'üà∫', 'üà∑', '‚ú¥', 'üÜö', 'üíÆ', 'üâê', '„äô',
            '„äó', 'üà¥', 'üàµ', 'üàπ', 'üà≤', 'üÖ∞', 'üÖ±', 'üÜé', 'üÜë', 'üÖæ',
            'üÜò', '‚ùå', '‚≠ï', 'üõë', '‚õî', 'üìõ', 'üö´', 'üíØ', 'üí¢', '‚ô®',
            'üö∑', 'üöØ', 'üö≥', 'üö±', 'üîû', 'üìµ', 'üö≠', '‚ùó', '‚ùï', '‚ùì',
            '‚ùî', '‚Äº', '‚Åâ', 'üîÖ', 'üîÜ', '„ÄΩ', '‚ö†', 'üö∏', 'üî±', '‚öú',
            'üî∞', '‚ôª', '‚úÖ', 'üàØ', 'üíπ', '‚ùá', '‚ú≥', '‚ùé', 'üåê', 'üí†',
            '‚ìÇ', 'üåÄ', 'üí§', 'üèß', 'üöæ', '‚ôø', 'üÖø', 'üà≥', 'üàÇ', 'üõÇ',
            'üõÉ', 'üõÑ', 'üõÖ', 'üöπ', 'üö∫', 'üöº', 'üöª', 'üöÆ', 'üé¶', 'üì∂',
            'üàÅ', 'üî£', '‚Ñπ', 'üî§', 'üî°', 'üî†', 'üÜñ', 'üÜó', 'üÜô', 'üÜí',
            'üÜï', 'üÜì', '0Ô∏è‚É£', '1Ô∏è‚É£', '2Ô∏è‚É£', '3Ô∏è‚É£', '4Ô∏è‚É£', '5Ô∏è‚É£', '6Ô∏è‚É£', '7Ô∏è‚É£',
            '8Ô∏è‚É£', '9Ô∏è‚É£', 'üîü', 'üî¢', '#Ô∏è‚É£', '*Ô∏è‚É£', '‚èè', '‚ñ∂', '‚è∏', '‚èØ',
            '‚èπ', '‚è∫', '‚è≠', '‚èÆ', '‚è©', '‚è™', '‚è´', '‚è¨', '‚óÄ', 'üîº',
            'üîΩ', '‚û°', '‚¨Ö', '‚¨Ü', '‚¨á', '‚Üó', '‚Üò', '‚Üô', '‚Üñ', '‚Üï',
            '‚Üî', '‚Ü™', '‚Ü©', '‚§¥', '‚§µ', 'üîÄ', 'üîÅ', 'üîÇ', 'üîÑ', 'üîÉ',
            'üéµ', 'üé∂', '‚ûï', '‚ûñ', '‚ûó', '‚úñ', '‚ôæ', 'üí≤', 'üí±', '‚Ñ¢',
            '¬©', '¬Æ', '„Ä∞', '‚û∞', '‚ûø', 'üîö', 'üîô', 'üîõ', 'üîù', 'üîú',
            '‚úî', '‚òë', 'üîò', 'üî¥', 'üü†', 'üü°', 'üü¢', 'üîµ', 'üü£', '‚ö´',
            '‚ö™', 'üü§', 'üî∫', 'üîª', 'üî∏', 'üîπ', 'üî∂', 'üî∑', 'üî≥', 'üî≤',
            '‚ñ™', '‚ñ´', '‚óæ', '‚óΩ', '‚óº', '‚óª', 'üü•', 'üüß', 'üü®', 'üü©',
            'üü¶', 'üü™', '‚¨õ', '‚¨ú', 'üü´', 'üîà', 'üîá', 'üîâ', 'üîä', 'üîî',
            'üîï', 'üì£', 'üì¢', 'üëÅ‚Äçüó®', 'üí¨', 'üí≠', 'üóØ', '‚ô†', '‚ô£', '‚ô•',
            '‚ô¶', 'üÉè', 'üé¥', 'üÄÑ', 'üïê', 'üïë', 'üïí', 'üïì', 'üïî', 'üïï',
            'üïñ', 'üïó', 'üïò', 'üïô', 'üïö', 'üïõ', 'üïú', 'üïù', 'üïû', 'üïü',
            'üï†', 'üï°', 'üï¢', 'üï£', 'üï§', 'üï•', 'üï¶', 'üïß'
        ]
        
        # –ü—Ä–∏—Ä–æ–¥–∞
        self.nature = [
            'üåç', 'üåé', 'üåè', 'üåê', 'üó∫', 'üóæ', 'üß≠', 'üèî', '‚õ∞', 'üåã',
            'üóª', 'üèï', 'üèñ', 'üèú', 'üèù', 'üèû', 'üèü', 'üèõ', 'üèó', 'üß±',
            'ü™®', 'ü™µ', 'üõñ', 'üèò', 'üèö', 'üè†', 'üè°', 'üè¢', 'üè£', 'üè§',
            '‚òÄ', 'üå§', '‚õÖ', 'üå•', '‚òÅ', 'üå¶', 'üåß', '‚õà', 'üå©', 'üå®',
            '‚ùÑ', '‚òÉ', '‚õÑ', 'üå¨', 'üí®', 'üíß', 'üí¶', '‚òî', '‚òÇ', 'üåä',
            'üå´', 'üå™', 'üåà', 'üåÇ', '‚ö°', 'üî•', 'üí•', '‚≠ê', 'üåü', '‚ú®',
            'üå†', 'üåå', '‚òÑ', 'üåô', 'üåõ', 'üåú', 'üåö', 'üåï', 'üåñ', 'üåó',
            'üåò', 'üåë', 'üåí', 'üåì', 'üåî', 'üåù', 'üåû', 'ü™ê', 'üí´', '‚≠ê',
            'üåü', '‚ú®', '‚ö°', '‚òÑ', 'üí•', 'üî•', 'üå™', 'üåà', '‚òÄ', 'üå§',
            '‚õÖ', 'üå•', '‚òÅ', 'üå¶', 'üåß', '‚õà', 'üå©', 'üå®', '‚ùÑ', '‚òÉ',
            '‚õÑ', 'üå¨', 'üí®', 'üíß', 'üí¶', '‚òî'
        ]
        
        # –§–ª–∞–≥–∏
        self.flags = [
            'üè≥', 'üè¥', 'üè¥‚Äç‚ò†Ô∏è', 'üèÅ', 'üö©', 'üè≥Ô∏è‚Äçüåà', 'üè≥Ô∏è‚Äç‚ößÔ∏è', 'üá∫üá≥'
        ]
        
        # –û–±—ä–µ–¥–∏–Ω—è–µ–º –í–°–Å –≤ –æ–¥–∏–Ω –º–µ–≥–∞-—Å–ø–∏—Å–æ–∫
        self.all_emojis = (
            self.smiles_faces + 
            self.gestures_hands + 
            self.people + 
            self.animals + 
            self.food + 
            self.activities + 
            self.travel + 
            self.objects + 
            self.symbols + 
            self.nature +
            self.flags
        )
        
    def add_noise(self, image):
        """–î–æ–±–∞–≤–ª—è–µ—Ç —à—É–º –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"""
        img_array = np.array(image)
        noise = np.random.randint(-30, 30, img_array.shape, dtype='int16')
        noisy_img = np.clip(img_array + noise, 0, 255).astype('uint8')
        return Image.fromarray(noisy_img)
    
    def add_stripes(self, image):
        """–î–æ–±–∞–≤–ª—è–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–µ –ø–æ–ª–æ—Å—ã"""
        draw = ImageDraw.Draw(image, 'RGBA')
        width, height = image.size
        
        num_stripes = random.randint(3, 8)
        
        for _ in range(num_stripes):
            if random.choice([True, False]):
                # –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ
                x = random.randint(0, width)
                stripe_width = random.randint(1, 5)
                color = (random.randint(0, 255), random.randint(0, 255), 
                        random.randint(0, 255), random.randint(10, 50))
                draw.rectangle([x, 0, x + stripe_width, height], fill=color)
            else:
                # –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ
                y = random.randint(0, height)
                stripe_height = random.randint(1, 5)
                color = (random.randint(0, 255), random.randint(0, 255), 
                        random.randint(0, 255), random.randint(10, 50))
                draw.rectangle([0, y, width, y + stripe_height], fill=color)
        
        return image
    
    def add_smiles(self, image):
        """–î–æ–±–∞–≤–ª—è–µ—Ç —ç–º–æ–¥–∑–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"""
        draw = ImageDraw.Draw(image, 'RGBA')
        width, height = image.size
        
        # –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å —à—Ä–∏—Ñ—Ç
        try:
            font_size = random.randint(20, 50)
            font = ImageFont.truetype("seguiemj.ttf", font_size)
        except:
            try:
                font = ImageFont.truetype("/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf", 30)
            except:
                try:
                    font = ImageFont.truetype("/System/Library/Fonts/Apple Color Emoji.ttc", 30)
                except:
                    font = ImageFont.load_default()
        
        # –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç 3 –¥–æ 10 —ç–º–æ–¥–∑–∏
        num_emojis = random.randint(3, 10)
        
        for _ in range(num_emojis):
            emoji = random.choice(self.all_emojis)
            x = random.randint(0, max(0, width - 60))
            y = random.randint(0, max(0, height - 60))
            
            # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–æ–Ω –ø–æ–¥ —ç–º–æ–¥–∑–∏
            if random.choice([True, False]):
                opacity = random.randint(100, 200)
                bg_size = random.randint(40, 70)
                draw.ellipse([x-5, y-5, x+bg_size, y+bg_size], 
                           fill=(random.randint(0, 255), 
                                random.randint(0, 255), 
                                random.randint(0, 255), 
                                random.randint(50, 100)))
            
            draw.text((x, y), emoji, font=font, fill=(255, 255, 255, random.randint(150, 255)))
        
        return image
    
    def change_background(self, image):
        """–ú–µ–Ω—è–µ—Ç/–¥–æ–±–∞–≤–ª—è–µ—Ç —Ñ–æ–Ω–æ–≤—ã–π —Å–ª–æ–π"""
        width, height = image.size
        
        # –†–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ñ–æ–Ω–∞
        bg_type = random.choice(['solid', 'gradient', 'noise'])
        
        if bg_type == 'solid':
            # –û–¥–Ω–æ—Ç–æ–Ω–Ω—ã–π —Ñ–æ–Ω
            background = Image.new('RGB', (width, height), 
                                  (random.randint(0, 255), 
                                   random.randint(0, 255), 
                                   random.randint(0, 255)))
        elif bg_type == 'gradient':
            # –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω
            background = Image.new('RGB', (width, height))
            draw = ImageDraw.Draw(background)
            r1, g1, b1 = random.randint(0, 255), random.randint(0, 255), random.randint(0, 255)
            r2, g2, b2 = random.randint(0, 255), random.randint(0, 255), random.randint(0, 255)
            
            for i in range(height):
                r = int(r1 + (r2 - r1) * i / height)
                g = int(g1 + (g2 - g1) * i / height)
                b = int(b1 + (b2 - b1) * i / height)
                draw.line([(0, i), (width, i)], fill=(r, g, b))
        else:
            # –®—É–º–æ–≤–æ–π —Ñ–æ–Ω
            background = Image.new('RGB', (width, height))
            bg_array = np.random.randint(0, 255, (height, width, 3), dtype='uint8')
            background = Image.fromarray(bg_array)
        
        # –î–µ–ª–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ–º–Ω–æ–≥–æ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º
        if image.mode != 'RGBA':
            image = image.convert('RGBA')
        
        # –ò–∑–º–µ–Ω—è–µ–º –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
        alpha = image.split()[3]
        alpha = ImageEnhance.Brightness(alpha).enhance(random.uniform(0.9, 0.98))
        image.putalpha(alpha)
        
        # –ù–∞–∫–ª–∞–¥—ã–≤–∞–µ–º
        background.paste(image, (0, 0), image)
        
        return background
    
    def apply_blur(self, image, radius):
        """–ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ä–∞–∑–º—ã—Ç–∏–µ"""
        if radius > 0:
            return image.filter(ImageFilter.GaussianBlur(radius=radius))
        return image
    
    def basic_modifications(self, image):
        """–ë–∞–∑–æ–≤—ã–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è —É–Ω–∏–∫–∞–ª–∏–∑–∞—Ü–∏–∏"""
        # –ü–æ–≤–æ—Ä–æ—Ç –Ω–∞ —Å–ª—É—á–∞–π–Ω—ã–π —É–≥–æ–ª
        angle = random.uniform(-2, 2)
        image = image.rotate(angle, expand=False, fillcolor=(255, 255, 255))
        
        # –ò–∑–º–µ–Ω–µ–Ω–∏–µ —è—Ä–∫–æ—Å—Ç–∏
        enhancer = ImageEnhance.Brightness(image)
        image = enhancer.enhance(random.uniform(0.95, 1.05))
        
        # –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞
        enhancer = ImageEnhance.Contrast(image)
        image = enhancer.enhance(random.uniform(0.95, 1.05))
        
        # –ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—ã—â–µ–Ω–Ω–æ—Å—Ç–∏
        enhancer = ImageEnhance.Color(image)
        image = enhancer.enhance(random.uniform(0.95, 1.05))
        
        # –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–∑–∫–æ—Å—Ç–∏
        enhancer = ImageEnhance.Sharpness(image)
        image = enhancer.enhance(random.uniform(0.9, 1.1))
        
        # –ù–µ–±–æ–ª—å—à–æ–π —Ä–µ—Å–∞–π–∑ –∏ –æ–±—Ä–∞—Ç–Ω–æ (–∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —Å–∂–∞—Ç–∏—è)
        original_size = image.size
        resize_factor = random.uniform(0.95, 0.99)
        temp_size = (int(original_size[0] * resize_factor), int(original_size[1] * resize_factor))
        image = image.resize(temp_size, Image.Resampling.LANCZOS)
        image = image.resize(original_size, Image.Resampling.LANCZOS)
        
        # –°–ª—É—á–∞–π–Ω—ã–π crop –∏ resize –æ–±—Ä–∞—Ç–Ω–æ
        if random.choice([True, False]):
            crop_percent = random.uniform(0.01, 0.03)
            left = int(original_size[0] * crop_percent)
            top = int(original_size[1] * crop_percent)
            right = int(original_size[0] * (1 - crop_percent))
            bottom = int(original_size[1] * (1 - crop_percent))
            image = image.crop((left, top, right, bottom))
            image = image.resize(original_size, Image.Resampling.LANCZOS)
        
        return image
    
    def uniqualize(self, image_bytes, params):
        """
        –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —É–Ω–∏–∫–∞–ª–∏–∑–∞—Ü–∏–∏
        params = {
            'noise': bool,
            'stripes': bool,
            'smiles': bool,
            'background': bool,
            'blur_radius': int (0-10)
        }
        """
        # –û—Ç–∫—Ä—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        image = Image.open(BytesIO(image_bytes))
        
        # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ RGB –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        if image.mode not in ('RGB', 'RGBA'):
            image = image.convert('RGB')
        
        # –ë–∞–∑–æ–≤—ã–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è–µ–º
        image = self.basic_modifications(image)
        
        # –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
        if params.get('background', False):
            image = self.change_background(image)
        
        if params.get('noise', False):
            image = self.add_noise(image)
        
        if params.get('stripes', False):
            image = self.add_stripes(image)
        
        if params.get('smiles', False):
            image = self.add_smiles(image)
        
        # –†–∞–∑–º—ã—Ç–∏–µ –ø—Ä–∏–º–µ–Ω—è–µ–º –≤ –∫–æ–Ω—Ü–µ
        blur_radius = params.get('blur_radius', 0)
        if blur_radius > 0:
            image = self.apply_blur(image, blur_radius)
        
        # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –æ–±—Ä–∞—Ç–Ω–æ –≤ bytes
        output = BytesIO()
        # –°–ª—É—á–∞–π–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ JPEG –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —É–Ω–∏–∫–∞–ª–∏–∑–∞—Ü–∏–∏
        quality = random.randint(85, 98)
        image.save(output, format='JPEG', quality=quality)
        output.seek(0)
        
        return output.getvalue()
